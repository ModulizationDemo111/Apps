<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title> IPA Library</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1c1c1e;
            color: #f2f2f7;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: auto;
            overflow: hidden;
            padding: 20px;
        }

        header {
            background: #2c2c2e;
            color: #f2f2f7;
            padding: 20px 0;
            text-align: center;
            border-bottom: #77a1d3 3px solid;
        }

        header h1 {
            margin: 0;
            font-size: 24px;
        }

        #search {
            width: 100%;
            padding: 10px;
            margin: 20px 0;
            display: block;
            font-size: 16px;
            background-color: #2c2c2e;
            border: 1px solid #3a3a3c;
            color: #f2f2f7;
        }

        .app {
            background: #2c2c2e;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .app img {
            float: left;
            margin-right: 20px;
            border-radius: 10px;
            width: 100px;
            height: 100px;
            background-color: gray;
        }

        .app h2 {
            margin-top: 0;
            color: #f2f2f7;
        }

        .app p {
            margin: 5px 0;
        }

        .app-details {
            overflow: hidden;
        }

        .version {
            background: #3a3a3c;
            padding: 10px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .version p {
            margin: 5px 0;
        }

        .error-message {
            color: red;
            text-align: center;
            margin-top: 20px;
        }

        .loading {
            text-align: center;
            margin-top: 20px;
        }

        .more-versions {
            margin-top: 10px;
            text-align: center;
        }

        .more-versions button {
            padding: 10px;
            background-color: #3a3a3c;
            color: #f2f2f7;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        .more-versions button:hover {
            background-
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: #2c2c2e;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 10px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #f2f2f7;
            text-decoration: none;
            cursor: pointer;
        }

        img[src=''],
        img:not([src]) {
            opacity: 0;
        }

/* 加载中的样式 */
        .loading {
            position: relative;
        }
        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(0, 0, 0, 0.3);
            border-top-color: #000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            transform: translate(-50%, -50%);
        }
        @keyframes spin {
            from { transform: translate(-50%, -50%) rotate(0deg); }
            to { transform: translate(-50%, -50%) rotate(360deg); }
        }

        /* 轻微缩放的动画样式 */
        .scaling {
            animation: scaleUpDown 0.25s ease-in-out infinite;
        }

        @keyframes scaleUpDown {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.3); /* 调整这里的值来控制放大效果 */
            }
        }
    </style>

</head>

<body>
    <header>
        <h1 id="library-name">Loading</h1>
    </header>
    <div class="container">
        <input type="text" id="search" placeholder="Search for apps...">
        <div id="app-container">
            <!-- App details will be injected here -->
        </div>
        <div id="error-container" class="error-message"></div>
        <div id="loading" class="loading">
            Loading...
        </div>
    </div>
    <div id="version-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div id="modal-versions"></div>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const loading = document.getElementById('loading');
            const errorContainer = document.getElementById('error-container');
            const appContainer = document.getElementById('app-container');
            const searchInput = document.getElementById('search');
            const modal = document.getElementById('version-modal');
            const modalContent = document.getElementById('modal-versions');
            const span = document.getElementsByClassName('close')[0];

            span.onclick = function () {
                modal.style.display = 'none';
                modalContent.innerHTML = '';
            }

            window.onclick = function (event) {
                if (event.target == modal) {
                    modal.style.display = 'none';
                    modalContent.innerHTML = '';
                }
            }

            function debounce(func, delay) {
                let timeout;
                return function (...args) {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => func.apply(this, args), delay);
                };
            }

            function displayApps(apps) {
                appContainer.innerHTML = '';
                apps.forEach(app => {
                    const appDiv = document.createElement('div');
                    appDiv.classList.add('app');

                    const icon = document.createElement('img');
                    icon.src = app.iconURL;
                    icon.style.opacity = 0;
                    icon.onerror = function () {
                        icon.src = 'https://dummyimage.com/300/0/1.png&text=IPALib';
                        icon.onerror = null;
                    };
                    icon.onload = function () {
                        icon.style.opacity = 1;
                    };
                    icon.alt = app.name;
                    appDiv.appendChild(icon);

                    icon.addEventListener('click', async function() {
            try {
                //icon.classList.add('loading');
                // 使用Apple的iTunes Search API查询App信息
                const response = await fetch(`https://itunes.apple.com/lookup?bundleId=${app.bundleID}`);
                const data = await response.json();

                // 检查是否有结果返回
                if (data.results && data.results.length > 0) {
                    // 获取appID
                    const appID = data.results[0].trackId;
                    // 构造App Store链接
                    const appStoreURL = `https://apps.apple.com/app/id${appID}`;
                    // 在新标签页打开App Store
                    window.open(appStoreURL,"_top");
                } else {
                    alert('未找到该应用，请检查 bundle ID 是否正确。');
                }
            } catch (error) {
                console.error('获取App信息时出错:', error);
                alert('获取App信息时发生错误，请稍后重试。'+error);
            }finally {
                // 移除 loading 类
                icon.classList.remove('loading');
            }
        });

                    const appDetails = document.createElement('div');
                    appDetails.classList.add('app-details');

                    const appName = document.createElement('h2');
                    appName.textContent = app.name;
                    appDetails.appendChild(appName);


                    const version = document.createElement('p');
                    version.innerHTML = `
    <span style="display: block; margin-bottom: 5px; text-align: left;">
        <strong style="">Description:</strong> ${app.localizedDescription}
    </span>
    <span style="display: block; margin-bottom: 5px; text-align: left;">
        <strong style="">Version:</strong> ${app.version}
    </span>

    <span style="display: block; margin-bottom: 5px; text-align: left;">
        <strong style="">Type:</strong> ${app.type}
    </span>
    <span style="display: block; margin-bottom: 5px; text-align: left;">
        <strong style="">Bundle ID:</strong> ${app.bundleID}
    </span>
    <span style="display: block; margin-bottom: 5px; text-align: left;">
        <strong style="">Version Date:</strong> ${app.versionDate}
    </span>
    <span style="display: block; margin-bottom: 5px; text-align: left;">
        <strong style="">Full Date:</strong> ${app.fullDate}
    </span>
    <span style="display: block; margin-bottom: 5px; text-align: left;">
        <strong style="">Size:</strong> ${(app.size / (1024*1024)).toFixed(2)} M
    </span>
    <span style="display: block; margin-bottom: 5px; text-align: left;">
        <strong style="">Downloads:</strong> 
        <a href="${app.down}" style="color: #007bff; text-decoration: none;" target="_blank">
            Click to Download
        </a>
    </span>
`;

                    appDetails.appendChild(version);


                    appDiv.appendChild(appDetails);


                    appContainer.appendChild(appDiv);
                });
            }

            let fetchUrl = "https://repo.apptesters.org/";

            fetch(fetchUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    return response.json();
                })
                .then(data => {
                    const libraryName = document.getElementById('library-name');
                    libraryName.textContent = data.name;

                    displayApps(data.apps);
                    loading.style.display = 'none';

                    data.apps.forEach(app => {
                        app.stringifiedData = JSON.stringify(app).toLowerCase();
                    });

                    searchInput.addEventListener('input', debounce(function () {
                        const query = this.value.toLowerCase();
                        const filteredApps = data.apps.filter(app =>
                            app.stringifiedData.includes(query)
                        );
                        displayApps(filteredApps);
                    }, 300)); // å»¶è¿300æ¯«ç§æ§è¡
                })
                .catch(error => {
                    errorContainer.textContent = 'Failed to load apps: ' + error.message;
                    loading.style.display = 'none';
                });
        });
    </script>
</body>

</html>
